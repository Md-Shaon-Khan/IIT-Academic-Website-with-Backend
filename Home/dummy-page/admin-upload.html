<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Upload Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="admin-upload.css">
</head>
<body>

<div class="main-wrapper">

    <!-- Top bar -->
    <div class="top-bar">
        <div class="portal-brand">
            <div class="brand-icon"><i class="fas fa-university"></i></div>
            <h1>Admin Portal <span>Content Management System</span></h1>
        </div>
        <button class="btn-logout" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i> Logout
        </button>
    </div>

    <!-- Main card -->
    <div class="selector-card">

        <p class="section-label">Step 1 ‚Äî Select Type</p>
        <h2 class="section-title">What would you like to upload?</h2>

        <div class="type-picker">
            <div class="type-option" id="opt-question" onclick="selectType('question')">
                <div class="type-icon"><i class="fas fa-file-alt"></i></div>
                <div class="type-text">
                    <h3>Question Paper</h3>
                    <p>Upload final or tutorial question files</p>
                </div>
            </div>
            <div class="type-option" id="opt-project" onclick="selectType('project')">
                <div class="type-icon"><i class="fas fa-project-diagram"></i></div>
                <div class="type-text">
                    <h3>Student Project</h3>
                    <p>Upload project details, images & descriptions</p>
                </div>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ QUESTION FORM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        <div id="questionSection" class="form-section">
            <hr class="divider">
            <p class="section-label">Step 2 ‚Äî Question Details</p>
            <h2 class="section-title">Question Paper Upload</h2>

            <form id="questionForm" enctype="multipart/form-data">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label">Batch</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-users"></i></span>
                            <input type="text" name="batch" class="form-control" placeholder="e.g. 52" required>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Year</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-calendar"></i></span>
                            <input type="text" name="year" class="form-control" placeholder="e.g. 2024" required>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Course</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-book"></i></span>
                            <input type="text" name="course" class="form-control" placeholder="Course code/name" required>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Question Type</label>
                        <select name="qtype" class="form-select" required>
                            <option value="">Select type‚Ä¶</option>
                            <option value="Final">Final Examination</option>
                            <option value="Tutorial">Tutorial</option>
                        </select>
                    </div>

                    <div class="col-md-6">
                        <div class="file-box">
                            <label class="form-label"><i class="fas fa-file-pdf me-2"></i>Question File</label>
                            <input type="file" name="file" class="form-control" required>
                        </div>
                    </div>

                    <div class="col-12">
                        <button type="submit" class="btn-submit">
                            <i class="fas fa-cloud-upload-alt"></i> Upload Question Paper
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ PROJECT FORM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        <div id="projectSection" class="form-section">
            <hr class="divider">
            <p class="section-label">Step 2 ‚Äî Project Details</p>
            <h2 class="section-title">Student Project Upload</h2>

            <form id="projectForm" enctype="multipart/form-data">
                <div class="row g-3">

                    <!-- Basic Info -->
                    <div class="col-12">
                        <p class="form-group-label"><i class="fas fa-info-circle me-1"></i> Basic Information</p>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">Batch Identifier</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-users"></i></span>
                            <input type="text" name="batch" class="form-control" placeholder="e.g. 52" required>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <label class="form-label">Project Title</label>
                        <input type="text" name="name" class="form-control" placeholder="Full scientific or formal project title" required>
                    </div>

                    <div class="col-12">
                        <label class="form-label">Quick Introduction</label>
                        <textarea name="intro" class="form-control" rows="2" placeholder="Briefly describe what this project is about‚Ä¶"></textarea>
                    </div>

                    <!-- Team -->
                    <div class="col-12">
                        <p class="form-group-label"><i class="fas fa-user-tie me-1"></i> Team & Supervision</p>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Supervising Faculty</label>
                        <input type="text" name="supervisor" class="form-control" placeholder="Prof. Name" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Project Contributors</label>
                        <input type="text" name="team" class="form-control" placeholder="John Doe, Jane Smith‚Ä¶" required>
                    </div>

                    <!-- Technical -->
                    <div class="col-12">
                        <p class="form-group-label"><i class="fas fa-cogs me-1"></i> Technical Details</p>
                    </div>

                    <div class="col-12">
                        <label class="form-label">Problem Statement</label>
                        <textarea name="problem" class="form-control" rows="3" placeholder="Define the problem this project addresses‚Ä¶" required></textarea>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Core Features</label>
                        <textarea name="features" class="form-control" rows="3" placeholder="List key functionalities‚Ä¶" required></textarea>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Tools & Technology Stack</label>
                        <textarea name="tools" class="form-control" rows="3" placeholder="Python, FastAPI, MySQL‚Ä¶" required></textarea>
                    </div>

                    <div class="col-12">
                        <label class="form-label">Future Impact & Potential</label>
                        <textarea name="impact" class="form-control" rows="2" placeholder="How does this project change or improve things?" required></textarea>
                    </div>

                    <!-- Media -->
                    <div class="col-12">
                        <p class="form-group-label"><i class="fas fa-images me-1"></i> Media Uploads</p>
                    </div>

                    <div class="col-md-6">
                        <div class="file-box">
                            <label class="form-label"><i class="fas fa-image me-2"></i>Main Cover Image</label>
                            <input type="file" name="image" class="form-control" accept="image/*" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="file-box">
                            <label class="form-label"><i class="fas fa-images me-2"></i>Project Gallery <small class="text-muted fw-normal">(multiple)</small></label>
                            <input type="file" name="related_images" class="form-control" accept="image/*" multiple>
                        </div>
                    </div>

                    <div class="col-12">
                        <button type="submit" class="btn-submit">
                            <i class="fas fa-paper-plane"></i> Finalize and Upload Project
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <p id="message"></p>
    </div><!-- /selector-card -->
</div>

<script>
    // üîê Auth guard
    if (!localStorage.getItem("admin_token")) {
        window.location.href = "admin.html";
    }

    // ‚îÄ‚îÄ Type selector ‚îÄ‚îÄ
    function selectType(type) {
        document.querySelectorAll(".type-option").forEach(el => el.classList.remove("active"));
        document.querySelectorAll(".form-section").forEach(el => el.classList.remove("active"));

        document.getElementById("opt-" + type).classList.add("active");
        document.getElementById(type + "Section").classList.add("active");
    }

    // ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ
    const msg = document.getElementById("message");
    function showMsg(text, isError) {
        msg.textContent = text;
        msg.className = isError ? "error" : "success";
    }

    const token = () => localStorage.getItem("admin_token");

    // ‚îÄ‚îÄ Question submit ‚îÄ‚îÄ
    document.getElementById("questionForm").addEventListener("submit", async function(e) {
        e.preventDefault();
        showMsg("Uploading‚Ä¶", false);
        const fd = new FormData(this);
        try {
            const res = await fetch("http://127.0.0.1:8000/admin/upload-question", {
                method: "POST",
                headers: { "Authorization": "Bearer " + token() },
                body: fd
            });
            const data = await res.json();
            if (res.ok) {
                showMsg("‚úî Question uploaded successfully!", false);
                this.reset();
            } else {
                showMsg("‚ùå " + (data.detail || "Upload failed"), true);
            }
        } catch {
            showMsg("üì° Connection error ‚Äî ensure the backend is running.", true);
        }
    });

    // ‚îÄ‚îÄ Project submit ‚îÄ‚îÄ
    document.getElementById("projectForm").addEventListener("submit", async function(e) {
        e.preventDefault();
        showMsg("Uploading‚Ä¶", false);
        const fd = new FormData(this);
        try {
            const res = await fetch("http://127.0.0.1:8000/upload-project/", {
                method: "POST",
                headers: { "Authorization": "Bearer " + token() },
                body: fd
            });
            const data = await res.json();
            if (res.ok) {
                showMsg("‚ú® Project saved to the database successfully!", false);
                this.reset();
            } else {
                showMsg("‚ùå " + (data.detail || "Upload failed"), true);
            }
        } catch {
            showMsg("üì° Connection error ‚Äî ensure the backend is running.", true);
        }
    });

    // ‚îÄ‚îÄ Logout ‚îÄ‚îÄ
    function logout() {
        localStorage.removeItem("admin_token");
        window.location.href = "admin.html";
    }
</script>

</body>
</html>
